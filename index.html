<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Orbix (ORX) - Official</title>
<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #f0f0f0;
    margin: 0; padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  header {
    padding: 1.5rem;
    font-size: 2rem;
    font-weight: bold;
    letter-spacing: 2px;
    color: #00ff99;
    margin-top: 2rem;
  }
  main {
    max-width: 400px;
    width: 90%;
    background: #1e1e1e;
    border-radius: 10px;
    padding: 2rem;
    box-shadow: 0 0 15px #00ff99aa;
    margin-top: 2rem;
    text-align: center;
  }
  button {
    background: #00ff99;
    color: #121212;
    font-weight: 700;
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #00cc7a;
  }
  .info {
    margin-top: 1.5rem;
    font-size: 1rem;
    word-break: break-all;
  }
  .price {
    margin-top: 1.5rem;
    font-size: 1.2rem;
    font-weight: 700;
    color: #00ff99;
  }
</style>
</head>
<body>

<header>Orbix (ORX) Token</header>

<main>
  <button id="connectWalletBtn">Connect Wallet</button>

  <div class="info" id="walletAddress"></div>
  <div class="info" id="tokenBalance"></div>
  <div class="price" id="tokenPrice">Token Price: N/A</div>
</main>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<script>
  const connectWalletBtn = document.getElementById('connectWalletBtn');
  const walletAddressDiv = document.getElementById('walletAddress');
  const tokenBalanceDiv = document.getElementById('tokenBalance');
  const tokenPriceDiv = document.getElementById('tokenPrice');

  // آدرس کانترکت توکن ORX روی شبکه پولیگون
  const ORX_CONTRACT_ADDRESS = '0xF4EDC72777e2AD20a02caA72b7BF51B7281BdAdE';

  // ABI ساده برای ERC20 (برای خواندن موجودی)
  const ERC20_ABI = [
    "function balanceOf(address owner) view returns (uint256)",
    "function decimals() view returns (uint8)"
  ];

  let provider;
  let signer;
  let contract;

  async function connectWallet() {
    if (typeof window.ethereum !== 'undefined') {
      try {
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();

        const address = await signer.getAddress();
        walletAddressDiv.innerText = 'Connected wallet: ' + address;
        connectWalletBtn.style.display = 'none';

        contract = new ethers.Contract(ORX_CONTRACT_ADDRESS, ERC20_ABI, provider);

        await updateTokenBalance(address);
        await updateTokenPrice();

        // برای تغییر حساب کیف پول اگر کاربر اکانت عوض کرد
        window.ethereum.on('accountsChanged', async (accounts) => {
          if (accounts.length > 0) {
            walletAddressDiv.innerText = 'Connected wallet: ' + accounts[0];
            await updateTokenBalance(accounts[0]);
          } else {
            walletAddressDiv.innerText = 'Wallet disconnected';
            tokenBalanceDiv.innerText = '';
            connectWalletBtn.style.display = 'inline-block';
          }
        });

      } catch (err) {
        walletAddressDiv.innerText = 'Connection rejected or failed.';
      }
    } else {
      walletAddressDiv.innerText = 'Please install MetaMask or compatible wallet!';
    }
  }

  async function updateTokenBalance(address) {
    try {
      const balance = await contract.balanceOf(address);
      const decimals = await contract.decimals();
      const formatted = ethers.utils.formatUnits(balance, decimals);
      tokenBalanceDiv.innerText = `ORX Token Balance: ${formatted}`;
    } catch {
      tokenBalanceDiv.innerText = 'Failed to load token balance';
    }
  }

  async function updateTokenPrice() {
    try {
      // کوین‌گکو شناسه پروژه ORX رو نداره هنوز، اینجا قیمت رو صفر نشون میدیم
      // بعداً میشه این API رو اصلاح کرد وقتی ثبت شد

      // نمونه درخواست قیمت (غیر فعال چون کوین وجود نداره):
      // let res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=orbix&vs_currencies=usd');
      // let data = await res.json();
      // let price = data.orbix?.usd || 'N/A';

      let price = 'N/A';
      tokenPriceDiv.innerText = 'Token Price: $' + price;
    } catch {
      tokenPriceDiv.innerText = 'Token Price: N/A';
    }
  }

  connectWalletBtn.addEventListener('click', connectWallet);
</script>

</body>
</html>
